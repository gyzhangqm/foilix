# xfoil on linux

## apt package

try:

`sudo apt-get install xfoil`

## deb package

See [http://ubuntuforums.org/showthread.php?t=288920](http://ubuntuforums.org/showthread.php?t=288920)

Get the .deb from [here](http://giuschet.altervista.org/Ubuntu/)

`sudo dpkg -i --force-architecture xfoil_6.97-1_i386.deb`

## build from sources (preferred)

### References

README available in the xfoil source code download (.tar.gz)

Timbos Blog [Compiling Xfoil on Debian (squeeze) ](http://macoovacany.blogspot.fr/2013/01/compiling-xfoil-on-debian-squeeze.html)

Icaro's Blog for [HOW TO Compile Xfoil 6.97 in Ubuntu Linux](https://giuseppeschettini.wordpress.com/2008/11/27/how-to-compile-xfoil-697-in-linux/)

### Prerequisites

Install the gfortran compiler

```Shell
sudo apt-get install gfortran
```

### Steps - Done with Ubuntu 14.04 Trusty 64 bits

Decide on if you are going to use double precision or single precision arithmetic. I chose double precision.

Download the source for the xfoil.

Build Orr-Sommerfeld database in ./orrs

```Shell
$ cd orrs
$ pwd
$ cd src
```

edit osmap.f

Find the following line in osmap.f (roughly line 100) : `DATA OSFILE / '/var/local/codes/orrs/osmap.dat' /`
Take the absolute directory string which is generated by the pwd command above, paste it in front of the osmap.dat filename,
e.g. `DATA OSFILE / '/home/me/src/Xfoil/orrs/osmap.dat' /`
This statement will tell SUBROUTINE OSMAP where to find this table data file. 

Find the following line in osmap.f (roughly line 75): `REAL*4 RLSP, WLSP, HLSP, & RINCR, WINCR, RL, WL, HL, & A, AR, AW, AH, ARW, ARH, AWH, ARWH`
Use double precision, change the REAL*4 to REAL.

```Shell
$ cd ../bin
```

edit Makefile

```INI
FC = gfortran
FLG = -O -fdefault-real-8
PLTLIB = -L/usr/X11R6/lib -lX11
FTNLIB = 
```

Note that the FLG setting -fdefault-real-8 changes the the compiler treats reals.
            
Make the osgen object and create binary file osmap.dat
```Shell
$ make osgen
$ make osmap.o
$ cd .. 
$ bin/osgen osmaps_ns.lst
``` 

Build the plot library in ./plotlib
```Shell
$ cd plotlib
```

edit Makefile (set compiler flags for your machine)
Comment out the include ./config.make
comment out PLTLIB = libPlt.a and uncomment PLTLIB = libPltDP.a
```INI
DP = -fdefault-real-8
```

```Shell
$ make
```

Build the programs in ./bin 
```Shell
$ cd bin
```

edit Makefile

Be sure to set up the FC variable and other compiler flags, FFLAGS and FFLOPT (used for xsolve) as appropriate. My settings were:
```INI
FC = gfortran
FFLAGS = -O3 -fdefault-real-8
FFLOPT = -O3 -fdefault-real-8
INSTALLCMD = install -s
CC = gcc
CFLAGS = -O -DUNDERSCORE
```

Note: some other instructions use the -c flag with gfortran.

```Shell
$ make xfoil
```

At this point, I got some arithmetic overflow errors:

```Shell
gfortran -c -O3 -fdefault-real8
../src/xoper.f:117.22:
IINPUT(I) = 2**31
                        1
Error: Arithmetic overflow at (1)
```

This can be fixed by modifying the source code. You need to make two changes, which are easily implemented using the sed command.
Thanks to Judson's Notes.:
```Shell
$ cd src/
$ sed -i 's/LOGICAL ERROR, LGETFN/LOGICAL ERROR, LGETFN, LERR/g' pplot.f
$ sed -i 's/IINPUT(I) = 2\*\*31/IINPUT(I) = HUGE(0)/g' xoper.f
```

```Shell
$make pplot
$make pxplot
```

If all works out, then you can run xfoil by going to the $BINDIR specified in the make file 
